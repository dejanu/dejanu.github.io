<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags for responsive -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Footer resources -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="media/assets/css/style.css">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<title>OS calculator</title>
</head>



<div style="display: flex; justify-content: center;">
<p><h2>Your <s>trusty</s> OpenSearch calculator</h2></p>
</div>

<br>
<hr>

<div style="display: flex; justify-content: center;">
  <form method="post" onsubmit="readData(); return false;">
      <p>Value in <b>GB</b> for ingested data: <input type="text" name="data_ingest" placeholder="Enter value i.e. 50 "></p>
      <p>Value in <b>days</b> for the rentention period: <input type="text" name="retention_period" placeholder="Enter value i.e. 30"></p>
      <p>Number of <b>data nodes</b>: <input type="text" name="data_nodes" placeholder="Enter value i.e. 4"></p>
      <div style="display: flex; justify-content: center;">
        <input type="checkbox" name="option" value="10" id="option1" onclick="onlyOne(this)">
        <label for="option1">10GB </label><br>
        <input type="checkbox" name="option" value="20" id="option2" onclick="onlyOne(this)">
        <label for="option2">20GB </label><br>
        <input type="checkbox" name="option" value="30" id="option3" onclick="onlyOne(this)">
        <label for="option3">30GB </label><br>
        <input type="checkbox" name="option" value="40" id="option4" onclick="onlyOne(this)">
        <label for="option4">40GB </label><br>
      </div>
      <br>
      <p><button class="btn btn-primary" type="submit">Calculate</button></p>
  </form>
</div>


<div class="d-inline-flex p-2 justify-content: center;">
  <p><div id="shards">Shards per cluster: </div></p>
  <p><div id="nodeshards">Shards per node: </div></p>
</div>

<hr>
<br>

<!-- create a js function that reads the node_no and write is in the page-->
<script>
  function readData() {
      var data_ingest = document.getElementsByName("data_ingest")[0].value;
      var retention_period = document.getElementsByName("retention_period")[0].value;
      var data_nodes = document.getElementsByName("data_nodes")[0].value;

      // verify if values from form can be converted to int
      var data_ingest_int = parseInt(data_ingest,10)
      var retention_period_int = parseInt(retention_period,10)
      var data_nodes_int = parseInt(data_nodes,10)

      if (Number.isInteger(data_ingest_int) && Number.isInteger(retention_period_int) && Number.isInteger(data_nodes_int)) {
          
        // formula: total_shards_per_cluster = (data_ingest * retention_period)/shard_size * (1 + replica_factor)
        // shard_size = 30; 

        var checkboxes = document.getElementsByName('option');
            var selectedValue = null;
            checkboxes.forEach((item) => {
                if (item.checked) {
                    selectedValue = item.value;
                }
            });
        alert("Selected value: " + selectedValue);

        shard_size = parseInt(selectedValue,10)

        replica_factor = 1;
        total_shards_per_cluster = (data_ingest_int * retention_period_int)/shard_size * (1 + replica_factor);

        // formula: no_of_shards_per_node = no_of_shard_per_index / no_of_data_nodes
        no_of_shards_per_node = Math.round(data_ingest_int / data_nodes_int)

        document.getElementById("shards").innerHTML = "Total shards per cluster: " + total_shards_per_cluster;
        document.getElementById("nodeshards").innerHTML = "Shards per node: " + no_of_shards_per_node
    
      } else {
          document.getElementById("shards").innerHTML = "Please enter a valid integer value";
          document.getElementById("nodeshards").innerHTML = "Please enter a valid integer value";
      }
  }
  function onlyOne(checkbox) {
            var checkboxes = document.getElementsByName('option');
            checkboxes.forEach((item) => {
                if (item !== checkbox) item.checked = false;
            })
        }
</script>



<div class="accordion" id="accordionExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
        Shard size
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <p>Ideally shard sizes should be between 10â€“50 GB, the calculations based on desired shard size <strong>selection</strong>.</p>
        <p>Shard size impacts both search latency and write performance, too many small shards will exhaust the memory (JVM Heap), and too few large shards prevent OpenSearch from properly distributing requests</p>
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
        Number of shards
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body">
      <p>There is a limit on how many shards a node can handle, itâ€™s useful to check how many shards a node can accommodate and search, by inspecting <a href="https://opensearch.org/docs/latest/install-and-configure/configuring-opensearch/cluster-settings/#cluster-level-shard-block-and-task-settings">cluster settings documentation</a>.</p>
      <p><code>cluster.max_shards_per_node</code> setting limits the total number of primary and replica shards for the cluster. Default is <code>1000</code></p>
      <p><img src="ossrc/indexvssearch.png" class="img-fluid" alt="Responsive image"></p>
    </div>
  </div>
  </div>
  <div class="accordion-item">
  <h2 class="accordion-header" id="headingTwo">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
      OpenSearch cluster health
    </button>
  </h2>
  <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
    <div class="accordion-body">
      <p>ðŸŸ¢ Green: all primary shards and their replicas are allocated to nodes </p>
      <p>ðŸŸ¡ Yellow: all primary shards are allocated to nodes, but some replicas arenâ€™t.</p>
      <p>ðŸ”´ Red: at least one primary shard and its replicas are not allocated to any node</p>
      <p> <strong>Unassigned shards cannot be deleted, an unassigned shard is not a corrupted shard, but a missing replica.</strong></p>
    </div>
  </div>
  </div>
</div>



</body>
</html>